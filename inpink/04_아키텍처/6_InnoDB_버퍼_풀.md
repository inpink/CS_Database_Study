# InnoDB 버퍼 풀
　   
InnoDB 버퍼 풀은 다음과 같은 역할을 한다.　   
- InnoDB 스토리지 엔진의 가장 핵심　   
- 메모리에 위치　   
- 디스크 데이터 파일 정보, 인덱스 정보 등을 캐시해둠　   
- 버퍼 역할(쓰기 작업을 지연시켜 한 번에 일괄 쓰기 처리)　   
　   
　   
> 버퍼 풀의 크기 설정

처음 서버를 구축하고 버퍼 풀의 크기를 정할 때,　   
전체 메모리의 크기의 50%부터 시작해서, 조금씩 늘려가며 최적점을 찾는 것이 가장 좋다.　   
　   
~~~
innodb_buffer_pool_size=256MB
~~~
버퍼 풀의 크기는 innodb_buffer_pool_size 시스템 변수로 조절할 수 있다.　   
**동적 변수**이기에, 서버가 서비스되고 있는 시점에서도 변경할 수 있다.　   
다만, 버퍼 풀의 크기를 변경하는 것은 시스템에 큰 영향을 줄 수 있기에 가능하면 서버가 한가한 시점에 바꿔주는 것이 좋다.　   
또, 늘리는 것은 괜찮지만 줄이는 것은 시스템 전체에 매우 큰 영향을 줄 수 있다. 따라서 지양하는 것이 좋다.　   
　   
버퍼 풀은 **128MB의 청크 단위로 쪼개져있다.**　   
따라서, 버퍼 풀의 크기를 설정할 때 128MB 단위로 설정하도록 하자.　   
　   
　   
> 버퍼 풀의 성능

InnoDB 버퍼 풀은 여러 페이지로 쪼개진다. 페이지의 크기는 innodb_page_size 시스템 변수에 지정해준 값이다.　   
　   
각 페이지에는 필요한 데이터들이 캐시된다.　   
이 때, 디스크에서 데이터를 읽어와서 저장해두는 것도 포함된다.　   
따라서, 이미 한 번 InnoDB 버퍼 풀로 읽어온 데이터를 다시 읽는 것은 매우 빠르게 할 수 있는 것이다.　   
　   
만약, **디스크의 모든 데이터파일을 InnoDB 버퍼 풀에 저장할 정도로 버퍼 풀의 사이즈가 크다면?**　   
모든 데이터를 저장해두기 때문에 쿼리의 성능이 매우 빨라진다.　   
그래서 **ⓐInnoDB 버퍼 풀의 사이즈를 키우는 것이 쿼리 성능을 향상시키는 하나의 방법**이 된다.　   
　   
하지만 모든 데이터파일을 저장할 공간이 부족하다면, 효과적으로 데이터들을 풀에 저장해야 한다.　   
이 때 InnoDB는 **ⓑLRU(Least Recently Used) + MRU(Most Recently Used) 알고리즘을 이용한 리스트** 를 사용한다. 　   
　   
도서 110p의 그림 4.13을 확인하자.　   
**최근에 읽힌 페이지는 상단으로 이동하며, New SubList에 저장된다.**　   
**최근에 읽히지 않을 수록 하단으로 이동하며, Old SubList에 저장된다.**　   
**새로운 페이지는, New SubList와 Old SubList의 사이에 저장된다.**　   
=> 이는, 디스크로부터 한 번 읽어온 페이지를 최대한 오랫동안 InnoDB 버퍼 풀의 메모리에 저장시켜서 디스크 읽기를 최소화하기 위한 전략이다.　   
　   
　   
**ⓒInnoDB 버퍼 풀의 성능을 위해서는  "쓰기 버퍼링"도 중요하다.**　   
=> 쓰기 버퍼링에는 **Redu log**과 관련이 깊다.　   
　   
쓰기 작업을 Redu log에 담아두는데, Redu log도 당연히 크기 설정이 중요하다.　   
Redu log는 **여러 개의 고정 파일을 연결해서 순환하여 사용한다.** 　   
즉, 계속해서 데이터 변경이 일어나면 Redu log의 맨 처음에 있던 데이터가 새로운 최신의 데이터 변경으로 덮어씌워지는 것이다.　   
   => LSN(Log Sequence Number)을 이용한다.　   
      InnoDB는 주기적으로 체크포인트 이벤트를 발생시켜, 체크포인트 LSN 값보다 작은 Redo log entry들은 디스크로 동기화시킨다. 　   
　   
Redo log 파일의 전체 크기를 정하는 것도, 최적화가 필요하다. 무작정 Redo log 파일의 크기가 큰 것이 좋은 것이 아니다.　   
처음에는 버퍼 풀의 크기의 5~10%정도로 정하고, 필요할 때마다 조금씩 늘려가는 방법이 가장 좋다.　   
　   
